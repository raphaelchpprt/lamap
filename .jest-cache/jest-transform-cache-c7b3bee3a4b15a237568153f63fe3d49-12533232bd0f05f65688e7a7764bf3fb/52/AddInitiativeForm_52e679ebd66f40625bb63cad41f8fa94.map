{"version":3,"sources":["/Users/Raphael/Documents/DEV.nosync/lamap/src/components/AddInitiativeForm.tsx"],"sourcesContent":["'use client';\n\nimport { useRef, useState } from 'react';\n\nimport { createInitiative } from '@/app/actions';\nimport { Button } from '@/components/ui/button';\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from '@/components/ui/card';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\n\nimport type { InitiativeType } from '@/types/initiative';\n\ninterface AddInitiativeFormProps {\n  onSuccess?: () => void;\n  onCancel?: () => void;\n}\n\nexport default function AddInitiativeForm({\n  onSuccess,\n  onCancel,\n}: AddInitiativeFormProps) {\n  const formRef = useRef<HTMLFormElement>(null);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  const initiativeTypes: InitiativeType[] = [\n    'Ressourcerie',\n    'Repair Café',\n    'AMAP',\n    \"Entreprise d'insertion\",\n    'Point de collecte',\n    'Recyclerie',\n    'Épicerie sociale',\n    'Jardin partagé',\n    'Fab Lab',\n    'Coopérative',\n    'Monnaie locale',\n    'Tiers-lieu',\n    'Autre',\n  ];\n\n  const handleSubmit = async (e: React.FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n    setIsSubmitting(true);\n    setError(null);\n\n    const formData = new FormData(e.currentTarget);\n    const name = formData.get('name') as string;\n    const type = formData.get('type') as InitiativeType;\n    const description = formData.get('description') as string;\n    const address = formData.get('address') as string;\n    const latitude = parseFloat(formData.get('latitude') as string);\n    const longitude = parseFloat(formData.get('longitude') as string);\n    const website = formData.get('website') as string;\n    const phone = formData.get('phone') as string;\n    const email = formData.get('email') as string;\n\n    if (!name || !type || isNaN(latitude) || isNaN(longitude)) {\n      setError('Veuillez remplir tous les champs obligatoires');\n      setIsSubmitting(false);\n      return;\n    }\n\n    try {\n      // Call server action\n      const result = await createInitiative({\n        name,\n        type,\n        description: description || undefined,\n        address: address || undefined,\n        latitude,\n        longitude,\n        website: website || undefined,\n        phone: phone || undefined,\n        email: email || undefined,\n      });\n\n      if (!result.success) {\n        throw new Error(result.error || 'Une erreur est survenue');\n      }\n\n      // Reset form and notify success\n      formRef.current?.reset();\n      onSuccess?.();\n    } catch (err) {\n      console.error(\"Erreur lors de l'ajout:\", err);\n      setError(err instanceof Error ? err.message : 'Une erreur est survenue');\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  return (\n    <Card className=\"w-full\">\n      <CardHeader>\n        <CardTitle>Ajouter une initiative</CardTitle>\n        <CardDescription>\n          Remplissez ce formulaire pour ajouter une nouvelle initiative ESS\n        </CardDescription>\n      </CardHeader>\n      <CardContent>\n        <form\n          ref={formRef}\n          onSubmit={handleSubmit}\n          className=\"space-y-6\"\n          noValidate\n        >\n          {error && (\n            <div\n              className=\"bg-destructive/10 border border-destructive/30 text-destructive px-4 py-3 rounded-lg\"\n              role=\"alert\"\n            >\n              {error}\n            </div>\n          )}\n\n          {/* Nom */}\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"name\">Initiative Name *</Label>\n            <Input\n              type=\"text\"\n              id=\"name\"\n              name=\"name\"\n              required\n              placeholder=\"Ex: Ressourcerie de Belleville\"\n            />\n          </div>\n\n          {/* Type */}\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"type\">Initiative Type *</Label>\n            <select\n              id=\"type\"\n              name=\"type\"\n              required\n              className=\"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\"\n            >\n              <option value=\"\">Sélectionnez un type</option>\n              {initiativeTypes.map((type) => (\n                <option key={type} value={type}>\n                  {type}\n                </option>\n              ))}\n            </select>\n          </div>\n\n          {/* Description */}\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"description\">Description</Label>\n            <textarea\n              id=\"description\"\n              name=\"description\"\n              rows={4}\n              className=\"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\"\n              placeholder=\"Décrivez l'initiative...\"\n            />\n          </div>\n\n          {/* Adresse */}\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"address\">Adresse</Label>\n            <Input\n              type=\"text\"\n              id=\"address\"\n              name=\"address\"\n              placeholder=\"Ex: 12 rue de la Paix, 75002 Paris\"\n            />\n          </div>\n\n          {/* Coordonnées GPS */}\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"latitude\">Latitude *</Label>\n              <Input\n                type=\"number\"\n                id=\"latitude\"\n                name=\"latitude\"\n                step=\"0.000001\"\n                required\n                placeholder=\"Ex: 48.8566\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"longitude\">Longitude *</Label>\n              <Input\n                type=\"number\"\n                id=\"longitude\"\n                name=\"longitude\"\n                step=\"0.000001\"\n                required\n                placeholder=\"Ex: 2.3522\"\n              />\n            </div>\n          </div>\n\n          {/* Informations de contact */}\n          <div className=\"space-y-4 pt-4 border-t\">\n            <h3 className=\"text-lg font-semibold\">Informations de contact</h3>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"website\">Site web</Label>\n              <Input\n                type=\"url\"\n                id=\"website\"\n                name=\"website\"\n                placeholder=\"https://exemple.com\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"phone\">Téléphone</Label>\n              <Input\n                type=\"tel\"\n                id=\"phone\"\n                name=\"phone\"\n                placeholder=\"01 23 45 67 89\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"email\">Email</Label>\n              <Input\n                type=\"email\"\n                id=\"email\"\n                name=\"email\"\n                placeholder=\"contact@exemple.com\"\n              />\n            </div>\n          </div>\n\n          {/* Boutons */}\n          <div className=\"flex gap-4 pt-4\">\n            <Button type=\"submit\" disabled={isSubmitting} className=\"flex-1\">\n              {isSubmitting ? 'Ajout en cours...' : \"Ajouter l'initiative\"}\n            </Button>\n\n            {onCancel && (\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={onCancel}\n                className=\"px-6\"\n              >\n                Annuler\n              </Button>\n            )}\n          </div>\n        </form>\n      </CardContent>\n    </Card>\n  );\n}\n"],"names":["AddInitiativeForm","onSuccess","onCancel","formRef","useRef","isSubmitting","setIsSubmitting","useState","error","setError","initiativeTypes","handleSubmit","e","preventDefault","formData","FormData","currentTarget","name","get","type","description","address","latitude","parseFloat","longitude","website","phone","email","isNaN","result","createInitiative","undefined","success","Error","current","reset","err","console","message","Card","className","CardHeader","CardTitle","CardDescription","CardContent","form","ref","onSubmit","noValidate","div","role","Label","htmlFor","Input","id","required","placeholder","select","option","value","map","textarea","rows","step","h3","Button","disabled","variant","onClick"],"mappings":"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"}