59088a89e414fa954217172ad6d4c88d
/**
 * Tests for Map component
 *
 * Tests the Mapbox integration, marker display, and clustering.
 */ "use strict";
// Mock mapbox-gl (uses __mocks__/mapbox-gl.js)
jest.mock('mapbox-gl');
// Mock Supabase client
jest.mock('@/lib/supabase/client', ()=>({
        createClient: jest.fn(()=>({
                from: jest.fn().mockReturnThis(),
                select: jest.fn().mockReturnThis(),
                eq: jest.fn().mockReturnThis(),
                single: jest.fn().mockResolvedValue({
                    data: [],
                    error: null
                })
            }))
    }));
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _jsxruntime = require("react/jsx-runtime");
const _react = require("@testing-library/react");
const _Map = /*#__PURE__*/ _interop_require_default(require("../../components/Map/Map"));
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
describe('Map Component', ()=>{
    beforeEach(()=>{
        // Set environment variable for Mapbox token
        process.env.NEXT_PUBLIC_MAPBOX_TOKEN = 'test-token';
    });
    it('should render map container', ()=>{
        (0, _react.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_Map.default, {}));
        const mapContainer = _react.screen.getByTestId('map-container');
        expect(mapContainer).toBeInTheDocument();
    });
    it('should apply custom className', ()=>{
        (0, _react.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_Map.default, {
            className: "custom-map-class"
        }));
        const mapContainer = _react.screen.getByTestId('map-container');
        expect(mapContainer).toHaveClass('custom-map-class');
    });
    it('should handle missing Mapbox token gracefully', ()=>{
        delete process.env.NEXT_PUBLIC_MAPBOX_TOKEN;
        // Should not throw
        expect(()=>(0, _react.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_Map.default, {}))).not.toThrow();
    });
    it('should render with default configuration', ()=>{
        const { container } = (0, _react.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_Map.default, {}));
        expect(container.querySelector('[data-testid="map-container"]')).toBeInTheDocument();
    });
    it('should call onInitiativeClick when provided', ()=>{
        const mockOnInitiativeClick = jest.fn();
        (0, _react.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_Map.default, {
            onInitiativeClick: mockOnInitiativeClick
        }));
        // Map is rendered, callback is set up
        expect(mockOnInitiativeClick).not.toHaveBeenCalled();
    });
    it('should call onMapClick when provided', ()=>{
        const mockOnMapClick = jest.fn();
        (0, _react.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_Map.default, {
            onMapClick: mockOnMapClick
        }));
        // Map is rendered, callback is set up
        expect(mockOnMapClick).not.toHaveBeenCalled();
    });
    it('should enable clustering by default', ()=>{
        (0, _react.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_Map.default, {}));
        const mapContainer = _react.screen.getByTestId('map-container');
        expect(mapContainer).toBeInTheDocument();
    });
    it('should disable clustering when specified', ()=>{
        (0, _react.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_Map.default, {
            enableClustering: false
        }));
        const mapContainer = _react.screen.getByTestId('map-container');
        expect(mapContainer).toBeInTheDocument();
    });
    it('should apply filters when provided', ()=>{
        const filters = {
            types: [
                'AMAP',
                'Repair CafÃ©'
            ]
        };
        (0, _react.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_Map.default, {
            filters: filters
        }));
        const mapContainer = _react.screen.getByTestId('map-container');
        expect(mapContainer).toBeInTheDocument();
    });
    it('should have correct height', ()=>{
        (0, _react.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_Map.default, {}));
        const mapContainer = _react.screen.getByTestId('map-container');
        expect(mapContainer).toHaveClass('h-full');
    });
    it('should have correct width', ()=>{
        (0, _react.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_Map.default, {}));
        const mapContainer = _react.screen.getByTestId('map-container');
        expect(mapContainer).toHaveClass('w-full');
    });
    it('should render without errors', ()=>{
        // Should not throw any errors
        expect(()=>(0, _react.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_Map.default, {}))).not.toThrow();
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9SYXBoYWVsL0RvY3VtZW50cy9ERVYubm9zeW5jL2xhbWFwL3NyYy9fX3Rlc3RzX18vY29tcG9uZW50cy9NYXAudGVzdC50c3giXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBUZXN0cyBmb3IgTWFwIGNvbXBvbmVudFxuICpcbiAqIFRlc3RzIHRoZSBNYXBib3ggaW50ZWdyYXRpb24sIG1hcmtlciBkaXNwbGF5LCBhbmQgY2x1c3RlcmluZy5cbiAqL1xuXG5pbXBvcnQgeyByZW5kZXIsIHNjcmVlbiB9IGZyb20gJ0B0ZXN0aW5nLWxpYnJhcnkvcmVhY3QnO1xuXG5pbXBvcnQgTWFwIGZyb20gJ0AvY29tcG9uZW50cy9NYXAvTWFwJztcblxuaW1wb3J0IHR5cGUgeyBJbml0aWF0aXZlVHlwZSB9IGZyb20gJ0AvdHlwZXMvaW5pdGlhdGl2ZSc7XG5cbi8vIE1vY2sgbWFwYm94LWdsICh1c2VzIF9fbW9ja3NfXy9tYXBib3gtZ2wuanMpXG5qZXN0Lm1vY2soJ21hcGJveC1nbCcpO1xuXG4vLyBNb2NrIFN1cGFiYXNlIGNsaWVudFxuamVzdC5tb2NrKCdAL2xpYi9zdXBhYmFzZS9jbGllbnQnLCAoKSA9PiAoe1xuICBjcmVhdGVDbGllbnQ6IGplc3QuZm4oKCkgPT4gKHtcbiAgICBmcm9tOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcbiAgICBzZWxlY3Q6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxuICAgIGVxOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcbiAgICBzaW5nbGU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICBkYXRhOiBbXSxcbiAgICAgIGVycm9yOiBudWxsLFxuICAgIH0pLFxuICB9KSksXG59KSk7XG5cbmRlc2NyaWJlKCdNYXAgQ29tcG9uZW50JywgKCkgPT4ge1xuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAvLyBTZXQgZW52aXJvbm1lbnQgdmFyaWFibGUgZm9yIE1hcGJveCB0b2tlblxuICAgIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX01BUEJPWF9UT0tFTiA9ICd0ZXN0LXRva2VuJztcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCByZW5kZXIgbWFwIGNvbnRhaW5lcicsICgpID0+IHtcbiAgICByZW5kZXIoPE1hcCAvPik7XG5cbiAgICBjb25zdCBtYXBDb250YWluZXIgPSBzY3JlZW4uZ2V0QnlUZXN0SWQoJ21hcC1jb250YWluZXInKTtcbiAgICBleHBlY3QobWFwQ29udGFpbmVyKS50b0JlSW5UaGVEb2N1bWVudCgpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGFwcGx5IGN1c3RvbSBjbGFzc05hbWUnLCAoKSA9PiB7XG4gICAgcmVuZGVyKDxNYXAgY2xhc3NOYW1lPVwiY3VzdG9tLW1hcC1jbGFzc1wiIC8+KTtcblxuICAgIGNvbnN0IG1hcENvbnRhaW5lciA9IHNjcmVlbi5nZXRCeVRlc3RJZCgnbWFwLWNvbnRhaW5lcicpO1xuICAgIGV4cGVjdChtYXBDb250YWluZXIpLnRvSGF2ZUNsYXNzKCdjdXN0b20tbWFwLWNsYXNzJyk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgaGFuZGxlIG1pc3NpbmcgTWFwYm94IHRva2VuIGdyYWNlZnVsbHknLCAoKSA9PiB7XG4gICAgZGVsZXRlIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX01BUEJPWF9UT0tFTjtcblxuICAgIC8vIFNob3VsZCBub3QgdGhyb3dcbiAgICBleHBlY3QoKCkgPT4gcmVuZGVyKDxNYXAgLz4pKS5ub3QudG9UaHJvdygpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHJlbmRlciB3aXRoIGRlZmF1bHQgY29uZmlndXJhdGlvbicsICgpID0+IHtcbiAgICBjb25zdCB7IGNvbnRhaW5lciB9ID0gcmVuZGVyKDxNYXAgLz4pO1xuXG4gICAgZXhwZWN0KFxuICAgICAgY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXRlc3RpZD1cIm1hcC1jb250YWluZXJcIl0nKVxuICAgICkudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBjYWxsIG9uSW5pdGlhdGl2ZUNsaWNrIHdoZW4gcHJvdmlkZWQnLCAoKSA9PiB7XG4gICAgY29uc3QgbW9ja09uSW5pdGlhdGl2ZUNsaWNrID0gamVzdC5mbigpO1xuXG4gICAgcmVuZGVyKDxNYXAgb25Jbml0aWF0aXZlQ2xpY2s9e21vY2tPbkluaXRpYXRpdmVDbGlja30gLz4pO1xuXG4gICAgLy8gTWFwIGlzIHJlbmRlcmVkLCBjYWxsYmFjayBpcyBzZXQgdXBcbiAgICBleHBlY3QobW9ja09uSW5pdGlhdGl2ZUNsaWNrKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGNhbGwgb25NYXBDbGljayB3aGVuIHByb3ZpZGVkJywgKCkgPT4ge1xuICAgIGNvbnN0IG1vY2tPbk1hcENsaWNrID0gamVzdC5mbigpO1xuXG4gICAgcmVuZGVyKDxNYXAgb25NYXBDbGljaz17bW9ja09uTWFwQ2xpY2t9IC8+KTtcblxuICAgIC8vIE1hcCBpcyByZW5kZXJlZCwgY2FsbGJhY2sgaXMgc2V0IHVwXG4gICAgZXhwZWN0KG1vY2tPbk1hcENsaWNrKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGVuYWJsZSBjbHVzdGVyaW5nIGJ5IGRlZmF1bHQnLCAoKSA9PiB7XG4gICAgcmVuZGVyKDxNYXAgLz4pO1xuXG4gICAgY29uc3QgbWFwQ29udGFpbmVyID0gc2NyZWVuLmdldEJ5VGVzdElkKCdtYXAtY29udGFpbmVyJyk7XG4gICAgZXhwZWN0KG1hcENvbnRhaW5lcikudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBkaXNhYmxlIGNsdXN0ZXJpbmcgd2hlbiBzcGVjaWZpZWQnLCAoKSA9PiB7XG4gICAgcmVuZGVyKDxNYXAgZW5hYmxlQ2x1c3RlcmluZz17ZmFsc2V9IC8+KTtcblxuICAgIGNvbnN0IG1hcENvbnRhaW5lciA9IHNjcmVlbi5nZXRCeVRlc3RJZCgnbWFwLWNvbnRhaW5lcicpO1xuICAgIGV4cGVjdChtYXBDb250YWluZXIpLnRvQmVJblRoZURvY3VtZW50KCk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgYXBwbHkgZmlsdGVycyB3aGVuIHByb3ZpZGVkJywgKCkgPT4ge1xuICAgIGNvbnN0IGZpbHRlcnMgPSB7XG4gICAgICB0eXBlczogWydBTUFQJywgJ1JlcGFpciBDYWbDqSddIGFzIEluaXRpYXRpdmVUeXBlW10sXG4gICAgfTtcblxuICAgIHJlbmRlcig8TWFwIGZpbHRlcnM9e2ZpbHRlcnN9IC8+KTtcblxuICAgIGNvbnN0IG1hcENvbnRhaW5lciA9IHNjcmVlbi5nZXRCeVRlc3RJZCgnbWFwLWNvbnRhaW5lcicpO1xuICAgIGV4cGVjdChtYXBDb250YWluZXIpLnRvQmVJblRoZURvY3VtZW50KCk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgaGF2ZSBjb3JyZWN0IGhlaWdodCcsICgpID0+IHtcbiAgICByZW5kZXIoPE1hcCAvPik7XG5cbiAgICBjb25zdCBtYXBDb250YWluZXIgPSBzY3JlZW4uZ2V0QnlUZXN0SWQoJ21hcC1jb250YWluZXInKTtcbiAgICBleHBlY3QobWFwQ29udGFpbmVyKS50b0hhdmVDbGFzcygnaC1mdWxsJyk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgaGF2ZSBjb3JyZWN0IHdpZHRoJywgKCkgPT4ge1xuICAgIHJlbmRlcig8TWFwIC8+KTtcblxuICAgIGNvbnN0IG1hcENvbnRhaW5lciA9IHNjcmVlbi5nZXRCeVRlc3RJZCgnbWFwLWNvbnRhaW5lcicpO1xuICAgIGV4cGVjdChtYXBDb250YWluZXIpLnRvSGF2ZUNsYXNzKCd3LWZ1bGwnKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCByZW5kZXIgd2l0aG91dCBlcnJvcnMnLCAoKSA9PiB7XG4gICAgLy8gU2hvdWxkIG5vdCB0aHJvdyBhbnkgZXJyb3JzXG4gICAgZXhwZWN0KCgpID0+IHJlbmRlcig8TWFwIC8+KSkubm90LnRvVGhyb3coKTtcbiAgfSk7XG59KTtcbiJdLCJuYW1lcyI6WyJqZXN0IiwibW9jayIsImNyZWF0ZUNsaWVudCIsImZuIiwiZnJvbSIsIm1vY2tSZXR1cm5UaGlzIiwic2VsZWN0IiwiZXEiLCJzaW5nbGUiLCJtb2NrUmVzb2x2ZWRWYWx1ZSIsImRhdGEiLCJlcnJvciIsImRlc2NyaWJlIiwiYmVmb3JlRWFjaCIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19NQVBCT1hfVE9LRU4iLCJpdCIsInJlbmRlciIsIk1hcCIsIm1hcENvbnRhaW5lciIsInNjcmVlbiIsImdldEJ5VGVzdElkIiwiZXhwZWN0IiwidG9CZUluVGhlRG9jdW1lbnQiLCJjbGFzc05hbWUiLCJ0b0hhdmVDbGFzcyIsIm5vdCIsInRvVGhyb3ciLCJjb250YWluZXIiLCJxdWVyeVNlbGVjdG9yIiwibW9ja09uSW5pdGlhdGl2ZUNsaWNrIiwib25Jbml0aWF0aXZlQ2xpY2siLCJ0b0hhdmVCZWVuQ2FsbGVkIiwibW9ja09uTWFwQ2xpY2siLCJvbk1hcENsaWNrIiwiZW5hYmxlQ2x1c3RlcmluZyIsImZpbHRlcnMiLCJ0eXBlcyJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Q0FJQztBQVFELCtDQUErQztBQUMvQ0EsS0FBS0MsSUFBSSxDQUFDO0FBRVYsdUJBQXVCO0FBQ3ZCRCxLQUFLQyxJQUFJLENBQUMseUJBQXlCLElBQU8sQ0FBQTtRQUN4Q0MsY0FBY0YsS0FBS0csRUFBRSxDQUFDLElBQU8sQ0FBQTtnQkFDM0JDLE1BQU1KLEtBQUtHLEVBQUUsR0FBR0UsY0FBYztnQkFDOUJDLFFBQVFOLEtBQUtHLEVBQUUsR0FBR0UsY0FBYztnQkFDaENFLElBQUlQLEtBQUtHLEVBQUUsR0FBR0UsY0FBYztnQkFDNUJHLFFBQVFSLEtBQUtHLEVBQUUsR0FBR00saUJBQWlCLENBQUM7b0JBQ2xDQyxNQUFNLEVBQUU7b0JBQ1JDLE9BQU87Z0JBQ1Q7WUFDRixDQUFBO0lBQ0YsQ0FBQTs7Ozs7dUJBcEIrQjs0REFFZjs7Ozs7O0FBb0JoQkMsU0FBUyxpQkFBaUI7SUFDeEJDLFdBQVc7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